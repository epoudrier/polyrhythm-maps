<html>
  <head>
    <title>Timeline-1</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Source for your Leaflet JavaScript and CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin=""
    />

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script
      src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
      crossorigin=""
    ></script>

    <!-- Add data source wrapped as a variable -->
    <script src="../corpus/corpus.js" charset="utf-8"></script>

    <!-- Add Slider Control source-->
    <script src="./SliderControl.js"></script>

    <!-- Add jquery CSS source-->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css"
    />

    <!-- Add jquery ui Javascript sources-->
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>

       <!-- Slider and Static Graph Container -->
       <style>
        #map .slider {
            background: rgba(255, 255, 255, 0.40);
            box-shadow: 0 1px 7px rgba(0, 0, 0, 0.65);
            border-radius: 6px;
            text-align: center;
            padding: 10px 40px 35px 40px;
            position: bottom left;     
        }
      </style>
      
  </head>

  <body>
    <!-- Map's HTML container -->
    <div id="map" style="height: 100%"></div>

    <script>
      // Initialize map; sets the initial view location and zoom level
      var map = L.map("map").setView([42, -35], 3);

      // Load the tile layer; can be changed to layer and style of your choice
      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/{style}/{z}/{x}/{y}" +
          (L.Browser.retina ? "@2x.png" : ".png"),
        {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: "abcd",
          maxZoom: 20,
          minZoom: 0,
          style: "light_all",
        }
      ).addTo(map);

      var testlayer = L.geoJSON(corpusdata, {
        onEachFeature: function (feature, layer) {
          if (
            feature.properties &&
            feature.properties.work_title &&
            feature.properties.premiere_date 
          ) {
            layer.bindPopup(
              "<p><b>Premiere Date: </b>" +
                feature.properties.premiere_date +
                "<br><b>Work: </b>" +
                feature.properties.work_title +
                "</p>"
            );
          }
        },
      });

      // Create SliderControl with setup options.
      // "timeAttribute" sets the timeline for the slider.
      // "range" sets a starting and ending point on the slider.
      var sliderControl = L.control.sliderControl({
         layer: testlayer,
         timeAttribute: "premiere_year",
         range: true
      }).addTo(map);

      // Create premiere_year properties for markers by extracting
      // the year only from premiere_data property. e.g.: "3-Jan-1931"
      // will have "1931" extracted from it.
      // Note that properties must be strings (not numbers).
      let m = sliderControl.options.markers;
      for (let i=0; i<m.length; i++) {
          let value = m[i].feature.properties.premiere_date;
          let matches = value.match(/(\d{4})/);
          if (matches) {
             m[i].feature.properties.premiere_year = matches[1];
          } else {
             // No invalid premiere_date values in the input data,
             //but just in case, set to the year 3000:
             m[i].feature.properties.premiere_year = "3000";
          }
      }

      // Sort sliderControl markers by premier_year:
      // Sorting numerically by year, but could also
      // sort premier_year string alphabetically in this case.
      sliderControl.options.markers.sort(function (a, b) {
         let A = a.feature.properties.premiere_year;
         let B = b.feature.properties.premiere_year;
         A = parseInt(A);
         B = parseInt(B);
         if (A < B) {
            return -1;
         } else if (A > B) {
            return +1;
         } else {
            return 0;
         }
      });

      // console.warn("FIRST PREMIER", m[0].feature.properties.premiere_year);
      // console.warn("LAST PREMIER", m[m.length-1].feature.properties.premiere_year);

      // Initialize the slider
      sliderControl.startSlider();

    </script>
  </body>
</html>
