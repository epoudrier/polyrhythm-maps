<html>
  <head>
    <title>Timeline-1</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Source for your Leaflet JavaScript and CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin=""
    />

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script
      src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
      crossorigin=""
    ></script>

    <!-- Add data source wrapped as a variable -->
    <script src="../corpus/corpus.js" charset="utf-8"></script>

    <!-- Add Slider Control source-->
    <script src="./SliderControl.js"></script>

    <!-- Add jquery CSS source-->
    <link
      rel="stylesheet"
      type="text/css"
      href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css"
    />

    <!-- Add jquery ui Javascript sources-->
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>

       <!-- Slider and Static Graph Container -->
       <style>
        #map .slider {
            background: rgba(255, 255, 255, 0.40);
            box-shadow: 0 1px 7px rgba(0, 0, 0, 0.65);
            border-radius: 6px;
            text-align: center;
            padding: 10px 40px 35px 40px;
            position: bottom left;     
        }
      </style>
      
  </head>

  <body>
    <!-- Map's HTML container -->
    <div id="map" style="height: 100%"></div>

    <script>
      // Initializes map; sets the initial view location and zoom level
      var map = L.map("map").setView([34, -35], 2.5);

      //Loads the tile layer; can be changed to layer and style of your choice
      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/{style}/{z}/{x}/{y}" +
          (L.Browser.retina ? "@2x.png" : ".png"),
        {
          attribution:
            '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: "abcd",
          maxZoom: 20,
          minZoom: 0,
          style: "light_all",
        }
      ).addTo(map);

//       Composer Name
// Work Title
// Genre (Sub-genre)
// Composition Year
// Premiere Date
// Publication Year
// Premiere Location: Venue, City, Country
// Performing Ensemble, Conductor, Soloist(s)
// Corpus Examples

      
      var testlayer = L.geoJSON(corpusdata, {
        onEachFeature: function (feature, layer) {
          if (
            feature.properties &&
            feature.properties.work_title &&
            feature.properties.genre &&
            feature.properties.sub_genre &&
            feature.properties.composition_year &&
            feature.properties.premiere_date &&
            feature.properties.premiere_venue &&
            feature.properties.premiere_city &&
            feature.properties.premiere_country &&
            feature.properties.ensemble &&
            feature.properties.conductor &&
            feature.properties.soloists &&
            feature.properties.example_no_2
          ) {
            layer.bindPopup(
              "<p><b>Premiere Date: </b>" +
                feature.properties.premiere_date +
                "<br><b>Work: </b>" +
                feature.properties.work_title +
                "<br><b>Genre: </b>" +
                feature.properties.genre +
                "<br><b>Sub-genre: </b>" +
                feature.properties.sub_genre +
                "<br><b>Composition Year: </b>" +
                feature.properties.composition_year +
                "<br><b>Premiere Venue: </b>" +
                feature.properties.premiere_venue +
                "<br><b>Premiere City: </b>" +
                feature.properties.premiere_city +
                "<br><b>Premiere Country: </b>" +
                feature.properties.premiere_country +
                "<br><b>Ensemble: </b>" +
                feature.properties.ensemble +
                "<br><b>Conductor: </b>" +
                feature.properties.conductor +
                "<br><b>Soloists: </b>" +
                feature.properties.soloists +
                "<br><b>Corpus Example: </b>" +
                feature.properties.example_no_2 +
                "</p>"
            );
          }
        },
      });

      //Sets variable for SliderControl
      var sliderControl = L.control.sliderControl({
        layer: testlayer,
      });

      //Add the slider to the map
      map.addControl(sliderControl);

      //Sort markers by first_publication_year
      sliderControl.options.markers.sort(function (a, b) {
         let A = a.feature.properties.first_publication_year;
         let B = b.feature.properties.first_publication_year;
         A = parseInt(A);
         if (Number.isNaN(A)) A = 3000;
         B = parseInt(B);
         if (Number.isNaN(B)) B = 3000;
         if (A < B) {
            return -1;
         } else if (B < A) {
            return 1;
         } else {
            return 0;
         }
      });

      //Initialize the slider
      sliderControl.startSlider();

      // Set timestamp property
      $("#slider-timestamp").html(
        options.markers[ui.value].feature.properties.first_publication_year)
    </script>
  </body>
</html>
